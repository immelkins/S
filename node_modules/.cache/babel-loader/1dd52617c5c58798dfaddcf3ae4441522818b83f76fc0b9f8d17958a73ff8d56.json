{"ast":null,"code":"// ToBinary.js\nimport { encryptData } from \"./ToBlackBox\";\nfunction uint8ArrayToBitArray(bytes) {\n  const bits = [];\n  for (const byte of bytes) {\n    for (let i = 7; i >= 0; i--) {\n      bits.push(byte >> i & 1);\n    }\n  }\n  return bits;\n}\nfunction stringToBitArray(str) {\n  const bits = [];\n  for (let i = 0; i < str.length; i++) {\n    const byte = str.charCodeAt(i);\n    for (let j = 7; j >= 0; j--) {\n      bits.push(byte >> j & 1);\n    }\n  }\n  return bits;\n}\nfunction numberTo32BitArray(num) {\n  const bits = [];\n  for (let i = 31; i >= 0; i--) {\n    bits.push(num >> i & 1);\n  }\n  return bits;\n}\nexport default async function ToBinary(file, password) {\n  if (!file) throw new Error(\"No file provided\");\n  if (!password || password.trim() === \"\") throw new Error(\"Password is required for encryption\");\n\n  // Read file\n  const arrayBuffer = await file.arrayBuffer();\n  const bytes = new Uint8Array(arrayBuffer);\n\n  // Encrypt raw bytes\n  const {\n    encryptedData,\n    iv,\n    salt\n  } = await encryptData(bytes, password);\n\n  // Encrypted payload to bit array\n  const payloadBits = uint8ArrayToBitArray(encryptedData);\n\n  // Metadata object\n  const metadata = {\n    iv,\n    salt,\n    originalLength: bytes.length,\n    fileName: file.name,\n    fileType: file.type\n  };\n\n  // Metadata to JSON string and then to bit array\n  const metadataStr = JSON.stringify(metadata);\n  const metadataBits = stringToBitArray(metadataStr);\n\n  // Add 32-bit length header at the start\n  const lengthBits = numberTo32BitArray(metadataBits.length);\n  const fullMetadataBits = [...lengthBits, ...metadataBits];\n  return {\n    bits: payloadBits,\n    metabits: fullMetadataBits\n  };\n}\n_c = ToBinary;\nvar _c;\n$RefreshReg$(_c, \"ToBinary\");","map":{"version":3,"names":["encryptData","uint8ArrayToBitArray","bytes","bits","byte","i","push","stringToBitArray","str","length","charCodeAt","j","numberTo32BitArray","num","ToBinary","file","password","Error","trim","arrayBuffer","Uint8Array","encryptedData","iv","salt","payloadBits","metadata","originalLength","fileName","name","fileType","type","metadataStr","JSON","stringify","metadataBits","lengthBits","fullMetadataBits","metabits","_c","$RefreshReg$"],"sources":["C:/Users/mesco/OneDrive/Documents/GitHub/S/src/components/ToBinary.js"],"sourcesContent":["// ToBinary.js\r\nimport { encryptData } from \"./ToBlackBox\";\r\n\r\nfunction uint8ArrayToBitArray(bytes) {\r\n  const bits = [];\r\n  for (const byte of bytes) {\r\n    for (let i = 7; i >= 0; i--) {\r\n      bits.push((byte >> i) & 1);\r\n    }\r\n  }\r\n  return bits;\r\n}\r\n\r\nfunction stringToBitArray(str) {\r\n  const bits = [];\r\n  for (let i = 0; i < str.length; i++) {\r\n    const byte = str.charCodeAt(i);\r\n    for (let j = 7; j >= 0; j--) {\r\n      bits.push((byte >> j) & 1);\r\n    }\r\n  }\r\n  return bits;\r\n}\r\n\r\nfunction numberTo32BitArray(num) {\r\n  const bits = [];\r\n  for (let i = 31; i >= 0; i--) {\r\n    bits.push((num >> i) & 1);\r\n  }\r\n  return bits;\r\n}\r\n\r\nexport default async function ToBinary(file, password) {\r\n  if (!file) throw new Error(\"No file provided\");\r\n  if (!password || password.trim() === \"\") throw new Error(\"Password is required for encryption\");\r\n\r\n  // Read file\r\n  const arrayBuffer = await file.arrayBuffer();\r\n  const bytes = new Uint8Array(arrayBuffer);\r\n\r\n  // Encrypt raw bytes\r\n  const { encryptedData, iv, salt } = await encryptData(bytes, password);\r\n\r\n  // Encrypted payload to bit array\r\n  const payloadBits = uint8ArrayToBitArray(encryptedData);\r\n\r\n  // Metadata object\r\n  const metadata = {\r\n    iv,\r\n    salt,\r\n    originalLength: bytes.length,\r\n    fileName: file.name,\r\n    fileType: file.type,\r\n  };\r\n\r\n  // Metadata to JSON string and then to bit array\r\n  const metadataStr = JSON.stringify(metadata);\r\n  const metadataBits = stringToBitArray(metadataStr);\r\n\r\n  // Add 32-bit length header at the start\r\n  const lengthBits = numberTo32BitArray(metadataBits.length);\r\n  const fullMetadataBits = [...lengthBits, ...metadataBits];\r\n\r\n  return {\r\n    bits: payloadBits,\r\n    metabits: fullMetadataBits,\r\n  };\r\n}\r\n"],"mappings":"AAAA;AACA,SAASA,WAAW,QAAQ,cAAc;AAE1C,SAASC,oBAAoBA,CAACC,KAAK,EAAE;EACnC,MAAMC,IAAI,GAAG,EAAE;EACf,KAAK,MAAMC,IAAI,IAAIF,KAAK,EAAE;IACxB,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;MAC3BF,IAAI,CAACG,IAAI,CAAEF,IAAI,IAAIC,CAAC,GAAI,CAAC,CAAC;IAC5B;EACF;EACA,OAAOF,IAAI;AACb;AAEA,SAASI,gBAAgBA,CAACC,GAAG,EAAE;EAC7B,MAAML,IAAI,GAAG,EAAE;EACf,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGG,GAAG,CAACC,MAAM,EAAEJ,CAAC,EAAE,EAAE;IACnC,MAAMD,IAAI,GAAGI,GAAG,CAACE,UAAU,CAACL,CAAC,CAAC;IAC9B,KAAK,IAAIM,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;MAC3BR,IAAI,CAACG,IAAI,CAAEF,IAAI,IAAIO,CAAC,GAAI,CAAC,CAAC;IAC5B;EACF;EACA,OAAOR,IAAI;AACb;AAEA,SAASS,kBAAkBA,CAACC,GAAG,EAAE;EAC/B,MAAMV,IAAI,GAAG,EAAE;EACf,KAAK,IAAIE,CAAC,GAAG,EAAE,EAAEA,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;IAC5BF,IAAI,CAACG,IAAI,CAAEO,GAAG,IAAIR,CAAC,GAAI,CAAC,CAAC;EAC3B;EACA,OAAOF,IAAI;AACb;AAEA,eAAe,eAAeW,QAAQA,CAACC,IAAI,EAAEC,QAAQ,EAAE;EACrD,IAAI,CAACD,IAAI,EAAE,MAAM,IAAIE,KAAK,CAAC,kBAAkB,CAAC;EAC9C,IAAI,CAACD,QAAQ,IAAIA,QAAQ,CAACE,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,MAAM,IAAID,KAAK,CAAC,qCAAqC,CAAC;;EAE/F;EACA,MAAME,WAAW,GAAG,MAAMJ,IAAI,CAACI,WAAW,CAAC,CAAC;EAC5C,MAAMjB,KAAK,GAAG,IAAIkB,UAAU,CAACD,WAAW,CAAC;;EAEzC;EACA,MAAM;IAAEE,aAAa;IAAEC,EAAE;IAAEC;EAAK,CAAC,GAAG,MAAMvB,WAAW,CAACE,KAAK,EAAEc,QAAQ,CAAC;;EAEtE;EACA,MAAMQ,WAAW,GAAGvB,oBAAoB,CAACoB,aAAa,CAAC;;EAEvD;EACA,MAAMI,QAAQ,GAAG;IACfH,EAAE;IACFC,IAAI;IACJG,cAAc,EAAExB,KAAK,CAACO,MAAM;IAC5BkB,QAAQ,EAAEZ,IAAI,CAACa,IAAI;IACnBC,QAAQ,EAAEd,IAAI,CAACe;EACjB,CAAC;;EAED;EACA,MAAMC,WAAW,GAAGC,IAAI,CAACC,SAAS,CAACR,QAAQ,CAAC;EAC5C,MAAMS,YAAY,GAAG3B,gBAAgB,CAACwB,WAAW,CAAC;;EAElD;EACA,MAAMI,UAAU,GAAGvB,kBAAkB,CAACsB,YAAY,CAACzB,MAAM,CAAC;EAC1D,MAAM2B,gBAAgB,GAAG,CAAC,GAAGD,UAAU,EAAE,GAAGD,YAAY,CAAC;EAEzD,OAAO;IACL/B,IAAI,EAAEqB,WAAW;IACjBa,QAAQ,EAAED;EACZ,CAAC;AACH;AAACE,EAAA,GAnC6BxB,QAAQ;AAAA,IAAAwB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}