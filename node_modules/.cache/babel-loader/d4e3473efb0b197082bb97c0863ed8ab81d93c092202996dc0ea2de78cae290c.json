{"ast":null,"code":"'use strict';\n\nvar ContentStream = require('contentstream');\nvar GifEncoder = require('gif-encoder');\nvar jpegJs = require('jpeg-js');\nvar PNG = require('pngjs-nozlib').PNG;\nvar ndarray = require('ndarray');\nvar ops = require('ndarray-ops');\nvar through = require('through');\nfunction handleData(array, data, frame) {\n  var i,\n    j,\n    ptr = 0,\n    c;\n  if (array.shape.length === 4) {\n    return handleData(array.pick(frame), data, 0);\n  } else if (array.shape.length === 3) {\n    if (array.shape[2] === 3) {\n      ops.assign(ndarray(data, [array.shape[0], array.shape[1], 3], [4, 4 * array.shape[0], 1]), array);\n      ops.assigns(ndarray(data, [array.shape[0] * array.shape[1]], [4], 3), 255);\n    } else if (array.shape[2] === 4) {\n      ops.assign(ndarray(data, [array.shape[0], array.shape[1], 4], [4, array.shape[0] * 4, 1]), array);\n    } else if (array.shape[2] === 1) {\n      ops.assign(ndarray(data, [array.shape[0], array.shape[1], 3], [4, 4 * array.shape[0], 1]), ndarray(array.data, [array.shape[0], array.shape[1], 3], [array.stride[0], array.stride[1], 0], array.offset));\n      ops.assigns(ndarray(data, [array.shape[0] * array.shape[1]], [4], 3), 255);\n    } else {\n      return new Error('Incompatible array shape');\n    }\n  } else if (array.shape.length === 2) {\n    ops.assign(ndarray(data, [array.shape[0], array.shape[1], 3], [4, 4 * array.shape[0], 1]), ndarray(array.data, [array.shape[0], array.shape[1], 3], [array.stride[0], array.stride[1], 0], array.offset));\n    ops.assigns(ndarray(data, [array.shape[0] * array.shape[1]], [4], 3), 255);\n  } else {\n    return new Error('Incompatible array shape');\n  }\n  return data;\n}\nfunction haderror(err) {\n  var result = through();\n  result.emit('error', err);\n  return result;\n}\nmodule.exports = function savePixels(array, type, options) {\n  options = options || {};\n  switch (type.toUpperCase()) {\n    case 'JPG':\n    case '.JPG':\n    case 'JPEG':\n    case '.JPEG':\n    case 'JPE':\n    case '.JPE':\n      var width = array.shape[0];\n      var height = array.shape[1];\n      var data = new Buffer(width * height * 4);\n      data = handleData(array, data);\n      var rawImageData = {\n        data: data,\n        width: width,\n        height: height\n      };\n      var jpegImageData = jpegJs.encode(rawImageData, options.quality);\n      return new ContentStream(jpegImageData.data);\n    case 'GIF':\n    case '.GIF':\n      var frames = array.shape.length === 4 ? array.shape[0] : 1;\n      var width = array.shape.length === 4 ? array.shape[1] : array.shape[0];\n      var height = array.shape.length === 4 ? array.shape[2] : array.shape[1];\n      var data = new Buffer(width * height * 4);\n      var gif = new GifEncoder(width, height);\n      gif.writeHeader();\n      for (var i = 0; i < frames; i++) {\n        data = handleData(array, data, i);\n        gif.addFrame(data);\n      }\n      gif.finish();\n      return gif;\n    case 'PNG':\n    case '.PNG':\n      var png = new PNG({\n        width: array.shape[0],\n        height: array.shape[1]\n      });\n      var data = handleData(array, png.data);\n      if (typeof data === 'Error') return haderror(data);\n      png.data = data;\n      return png.pack();\n    case 'CANVAS':\n      var canvas = document.createElement('canvas');\n      var context = canvas.getContext('2d');\n      canvas.width = array.shape[0];\n      canvas.height = array.shape[1];\n      var imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n      var data = imageData.data;\n      data = handleData(array, data);\n      if (typeof data === 'Error') return haderror(data);\n      context.putImageData(imageData, 0, 0);\n      return canvas;\n    default:\n      return haderror(new Error('Unsupported file type: ' + type));\n  }\n};","map":{"version":3,"names":["ContentStream","require","GifEncoder","jpegJs","PNG","ndarray","ops","through","handleData","array","data","frame","i","j","ptr","c","shape","length","pick","assign","assigns","stride","offset","Error","haderror","err","result","emit","module","exports","savePixels","type","options","toUpperCase","width","height","Buffer","rawImageData","jpegImageData","encode","quality","frames","gif","writeHeader","addFrame","finish","png","pack","canvas","document","createElement","context","getContext","imageData","getImageData","putImageData"],"sources":["/Users/melvinescobar/Steganography/node_modules/save-pixels-jpeg-js-upgrade/save-pixels.js"],"sourcesContent":["'use strict'\n\nvar ContentStream = require('contentstream')\nvar GifEncoder = require('gif-encoder')\nvar jpegJs = require('jpeg-js')\nvar PNG = require('pngjs-nozlib').PNG\nvar ndarray = require('ndarray')\nvar ops = require('ndarray-ops')\nvar through = require('through')\n\nfunction handleData (array, data, frame) {\n  var i, j, ptr = 0, c\n  if (array.shape.length === 4) {\n    return handleData(array.pick(frame), data, 0)\n  } else if (array.shape.length === 3) {\n    if (array.shape[2] === 3) {\n      ops.assign(\n        ndarray(data,\n          [array.shape[0], array.shape[1], 3],\n          [4, 4 * array.shape[0], 1]),\n        array)\n      ops.assigns(\n        ndarray(data,\n          [array.shape[0] * array.shape[1]],\n          [4],\n          3),\n        255)\n    } else if (array.shape[2] === 4) {\n      ops.assign(\n        ndarray(data,\n          [array.shape[0], array.shape[1], 4],\n          [4, array.shape[0] * 4, 1]),\n        array)\n    } else if (array.shape[2] === 1) {\n      ops.assign(\n        ndarray(data,\n          [array.shape[0], array.shape[1], 3],\n          [4, 4 * array.shape[0], 1]),\n        ndarray(array.data,\n          [array.shape[0], array.shape[1], 3],\n          [array.stride[0], array.stride[1], 0],\n          array.offset))\n      ops.assigns(\n        ndarray(data,\n          [array.shape[0] * array.shape[1]],\n          [4],\n          3),\n        255)\n    } else {\n      return new Error('Incompatible array shape')\n    }\n  } else if (array.shape.length === 2) {\n    ops.assign(\n      ndarray(data,\n        [array.shape[0], array.shape[1], 3],\n        [4, 4 * array.shape[0], 1]),\n      ndarray(array.data,\n        [array.shape[0], array.shape[1], 3],\n        [array.stride[0], array.stride[1], 0],\n        array.offset))\n    ops.assigns(\n      ndarray(data,\n        [array.shape[0] * array.shape[1]],\n        [4],\n        3),\n      255)\n  } else {\n    return new Error('Incompatible array shape')\n  }\n  return data\n}\n\nfunction haderror (err) {\n  var result = through()\n  result.emit('error', err)\n  return result\n}\n\nmodule.exports = function savePixels (array, type, options) {\n  options = options || {}\n  switch (type.toUpperCase()) {\n    case 'JPG':\n    case '.JPG':\n    case 'JPEG':\n    case '.JPEG':\n    case 'JPE':\n    case '.JPE':\n      var width = array.shape[0]\n      var height = array.shape[1]\n      var data = new Buffer(width * height * 4)\n      data = handleData(array, data)\n      var rawImageData = {\n        data: data,\n        width: width,\n        height: height\n      }\n      var jpegImageData = jpegJs.encode(rawImageData, options.quality)\n      return new ContentStream(jpegImageData.data)\n\n    case 'GIF':\n    case '.GIF':\n      var frames = array.shape.length === 4 ? array.shape[0] : 1\n      var width = array.shape.length === 4 ? array.shape[1] : array.shape[0]\n      var height = array.shape.length === 4 ? array.shape[2] : array.shape[1]\n      var data = new Buffer(width * height * 4)\n      var gif = new GifEncoder(width, height)\n      gif.writeHeader()\n      for (var i = 0; i < frames; i++) {\n        data = handleData(array, data, i)\n        gif.addFrame(data)\n      }\n      gif.finish()\n      return gif\n\n    case 'PNG':\n    case '.PNG':\n      var png = new PNG({\n        width: array.shape[0],\n        height: array.shape[1]\n      })\n      var data = handleData(array, png.data)\n      if (typeof data === 'Error') return haderror(data)\n      png.data = data\n      return png.pack()\n\n    case 'CANVAS':\n      var canvas = document.createElement('canvas')\n      var context = canvas.getContext('2d')\n      canvas.width = array.shape[0]\n      canvas.height = array.shape[1]\n      var imageData = context.getImageData(0, 0, canvas.width, canvas.height)\n      var data = imageData.data\n      data = handleData(array, data)\n      if (typeof data === 'Error') return haderror(data)\n      context.putImageData(imageData, 0, 0)\n      return canvas\n\n    default:\n      return haderror(new Error('Unsupported file type: ' + type))\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}