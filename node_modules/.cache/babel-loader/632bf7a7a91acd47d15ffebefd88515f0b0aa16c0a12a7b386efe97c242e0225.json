{"ast":null,"code":"// ToBinary.js\nimport Hamming from \"hamming-code\"; // make sure to npm install hamming-code\n\nfunction uint8ArrayToBitArray(bytes) {\n  const bits = [];\n  for (const byte of bytes) {\n    for (let i = 7; i >= 0; i--) {\n      bits.push(byte >> i & 1);\n    }\n  }\n  return bits;\n}\nfunction stringToBitArray(str) {\n  const bits = [];\n  for (let i = 0; i < str.length; i++) {\n    const byte = str.charCodeAt(i);\n    for (let j = 7; j >= 0; j--) {\n      bits.push(byte >> j & 1);\n    }\n  }\n  return bits;\n}\nfunction numberTo32BitArray(num) {\n  const bits = [];\n  for (let i = 31; i >= 0; i--) {\n    bits.push(num >> i & 1);\n  }\n  return bits;\n}\nexport default async function ToBinary(file) {\n  if (!file) throw new Error(\"No file provided\");\n  const arrayBuffer = await file.arrayBuffer();\n  const bytes = new Uint8Array(arrayBuffer);\n\n  // Convert raw bytes to bits\n  let messageBits = uint8ArrayToBitArray(bytes);\n\n  // Encode message bits with Hamming ECC\n  const messageBitString = messageBits.join(\"\"); // Convert array to string\n  const encodedBitString = Hamming.encode(messageBitString); // Hamming encode\n  messageBits = encodedBitString.split(\"\").map(b => parseInt(b, 10)); // Back to array\n\n  // --- Add 32-bit length prefix for payload ---\n  const lengthMessageBits = numberTo32BitArray(messageBits.length);\n  const payloadBits = [...lengthMessageBits, ...messageBits];\n\n  // --- Create metadata object ---\n  const metadata = {\n    originalLength: bytes.length,\n    fileName: file.name,\n    fileType: file.type,\n    payloadBitsLength: messageBits.length // store ECC-encoded length\n  };\n\n  // --- Convert metadata to bits ---\n  const metadataStr = JSON.stringify(metadata);\n  const metadataBits = stringToBitArray(metadataStr);\n\n  // --- Add 32-bit metadata length prefix ---\n  const lengthMetaBits = numberTo32BitArray(metadataBits.length);\n  const fullMetadataBits = [...lengthMetaBits, ...metadataBits];\n  return {\n    bits: payloadBits,\n    metabits: fullMetadataBits\n  };\n}\n_c = ToBinary;\nvar _c;\n$RefreshReg$(_c, \"ToBinary\");","map":{"version":3,"names":["Hamming","uint8ArrayToBitArray","bytes","bits","byte","i","push","stringToBitArray","str","length","charCodeAt","j","numberTo32BitArray","num","ToBinary","file","Error","arrayBuffer","Uint8Array","messageBits","messageBitString","join","encodedBitString","encode","split","map","b","parseInt","lengthMessageBits","payloadBits","metadata","originalLength","fileName","name","fileType","type","payloadBitsLength","metadataStr","JSON","stringify","metadataBits","lengthMetaBits","fullMetadataBits","metabits","_c","$RefreshReg$"],"sources":["C:/Users/mesco/OneDrive/Documents/GitHub/S/src/components/ToBinary.js"],"sourcesContent":["// ToBinary.js\r\nimport Hamming from \"hamming-code\"; // make sure to npm install hamming-code\r\n\r\nfunction uint8ArrayToBitArray(bytes) {\r\n  const bits = [];\r\n  for (const byte of bytes) {\r\n    for (let i = 7; i >= 0; i--) \r\n      { bits.push((byte >> i) & 1); }\r\n  }\r\n  return bits;\r\n}\r\n\r\nfunction stringToBitArray(str) {\r\n  const bits = [];\r\n  for (let i = 0; i < str.length; i++) {\r\n    const byte = str.charCodeAt(i);\r\n    for (let j = 7; j >= 0; j--) \r\n      { bits.push((byte >> j) & 1); }\r\n  }\r\n  return bits;\r\n}\r\n\r\nfunction numberTo32BitArray(num) {\r\n  const bits = [];\r\n  for (let i = 31; i >= 0; i--) \r\n    { bits.push((num >> i) & 1); }\r\n  return bits;\r\n}\r\n\r\nexport default async function ToBinary(file) {\r\n  if (!file) throw new Error(\"No file provided\");\r\n  const arrayBuffer = await file.arrayBuffer();\r\n  const bytes = new Uint8Array(arrayBuffer);\r\n\r\n  // Convert raw bytes to bits\r\n  let messageBits = uint8ArrayToBitArray(bytes);\r\n\r\n  // Encode message bits with Hamming ECC\r\n  const messageBitString = messageBits.join(\"\");                      // Convert array to string\r\n  const encodedBitString = Hamming.encode(messageBitString);          // Hamming encode\r\n  messageBits = encodedBitString.split(\"\").map(b => parseInt(b, 10)); // Back to array\r\n\r\n  // --- Add 32-bit length prefix for payload ---\r\n  const lengthMessageBits = numberTo32BitArray(messageBits.length);\r\n  const payloadBits = [...lengthMessageBits, ...messageBits];\r\n\r\n  // --- Create metadata object ---\r\n  const metadata = {\r\n    originalLength: bytes.length,\r\n    fileName: file.name,\r\n    fileType: file.type,\r\n    payloadBitsLength: messageBits.length, // store ECC-encoded length\r\n  };\r\n\r\n  // --- Convert metadata to bits ---\r\n  const metadataStr = JSON.stringify(metadata);\r\n  const metadataBits = stringToBitArray(metadataStr);\r\n\r\n  // --- Add 32-bit metadata length prefix ---\r\n  const lengthMetaBits = numberTo32BitArray(metadataBits.length);\r\n  const fullMetadataBits = [...lengthMetaBits, ...metadataBits];\r\n\r\n  return { bits: payloadBits, metabits: fullMetadataBits };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}